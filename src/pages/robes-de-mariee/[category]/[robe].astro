---
import Layout from "../../../layouts/Layout.astro";

// Importer les fichiers JSON (Assurez-vous que ces fichiers existent)
import sirene from "../../../data/forme-sirene.json";
import princesse from "../../../data/forme-princesse.json";
import minimaliste from "../../../data/minimaliste.json";
import boheme from "../../../data/style-boheme-chic.json";

// üõ†Ô∏è Fonction pour cr√©er un slug propre
const slugify = (text) => {
  return text
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^\w-]+/g, "");
};

// ‚úÖ Fusionner toutes les robes en un seul tableau
const allRobes = [...sirene, ...princesse, ...minimaliste, ...boheme];

// üöÄ **G√©n√©rer les routes dynamiques**
export async function getStaticPaths() {
  const paths = allRobes.map(robe => ({
    params: {
      category: robe.category, // Utilisation de la cat√©gorie comme param√®tre
      robe: slugify(robe.dressName) // Cr√©ation du slug de la robe
    }
  }));

  return { paths };
}

// üîç **R√©cup√©rer la cat√©gorie et le slug de l'URL**
const { category, robe } = Astro.params;

// üè∑Ô∏è **Trouver la robe correspondante**
const robeData = allRobes.find(r => 
  r.category === category && 
  slugify(r.dressName) === robe
);

// üö® **Si aucune robe trouv√©e, afficher une erreur**
if (!robeData) {
  throw new Error(`Robe non trouv√©e ! Cat√©gorie: ${category}, Slug: ${robe}`);
}
---

<Layout
  title={`${robeData.dressName} - Monica Mariage`}
  description={`D√©couvrez la robe ${robeData.dressName}, disponible chez Monica Mariage Toulouse.`}
>
  <section class="py-12 bg-gradient-to-b from-white to-[#FDE9E6]">
    <div class="max-w-3xl mx-auto text-center">
      <h1 class="font-cursive text-5xl font-semibold text-[#af7749] mb-4">
        {robeData.dressName}
      </h1>
      <img
        src={robeData.imageUrl}
        alt={robeData.dressName}
        class="w-full max-h-[500px] object-cover rounded-lg shadow-lg"
      />
      <p class="mt-4 text-lg text-black">
        {robeData.description || "D√©couvrez cette robe de mari√©e √©l√©gante et unique."}
      </p>
      <a href="/prendre-rendez-vous">
        <button class="mt-6 bg-[#af7749] text-white py-2 px-6 rounded-lg shadow-lg hover:bg-[#925c36] transition duration-300">
          Prendre rendez-vous
        </button>
      </a>
    </div>
  </section>
</Layout>
